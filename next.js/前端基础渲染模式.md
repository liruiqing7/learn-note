# 前端基础渲染模式

1. [渲染是什么？](#渲染的概念)
2. 什么是客户端渲染？
3. 什么是服务端渲染？（服务端渲染的运行机制）
4. 什么是同构渲染？

## 渲染的概念

可以把渲染理解为：`渲染就是将页面数据和页面模板组装成html的过程。`
也就是 `data + template = html`，当然 data 可能什么都没有，没有数据也是一种数据。

## 客户端渲染（CSR）

客户端渲染就是`data + template = html`过程在客户端进行，服务器直接转发静态 html 资源即可。
常见的形式就是：

> 打包的时候生成只有 css、js 等外链标签的空白页，客户端在请求的时候，服务端不做任何处理，直接以原文件的形式返回给客户端，客户端获取到页面后，在加载完 js 后才通过 js 来渲染页面内容。

### 优势和劣势

- 优势：
  - 服务器压力小，只用进行转发较小的静态页面。
  - 前后端分离，代码逻辑更清晰，不需要考虑代码能不能再服务端运行，不需要考虑服务端的一些注意事项。
  - 可以进行局部刷新，无需每次请求完整页面、交互好可实现各种效果。
- 劣势：
  - 不利于 SEO：网络爬虫可能看不到完整的程序源码，获取不到页面关键信息。不过现在有的搜索引擎也可以了。
  - 首屏渲染慢：渲染前需要下载一堆 js 和 css 等，而且很多并不是首页需要的 js 和 css，不过按需加载也可以加快首屏加载，下载 js 和解析 js 的时间成本都不低。

## 服务端渲染（SSR）

这里主要是传统的服务端渲染，现代的服务端渲染指的是同构渲染。

### 什么是服务端渲染？

指的是`data + template = html`的过程在服务端进行，客户端不需要渲染页面。

具体解释就是：服务端渲染的模式下，当用户第一次请求页面的时候，由服务器把需要的组件或者页面渲染成 HTML 字符串，然后把它返回给客户端。客户端拿到手的，就是直接渲染然后呈现给用户的 HTML 内容，不需要为了生成 DOM 内容自己再去跑一遍 JS 代码。使用服务端渲染的网站，可以说是“所见即所得”，页面上呈现的内容，我们在 html 源文件里也能找得到。

- 优势：

  - 首屏渲染速度快
  - 利于 SEO
  - 可以生成缓存片段
  - 生成静态化文件
  - 客户端资源更小，对用户来说更节能

- 劣势：
  - 传统服务端渲染的用户体验差，不容易维护，通常改了部分 html 或者 css，后端也需要修改。
  - 服务器压力大，可以用静态化来解决。
  - 需要考虑服务端的一些注意事项。

### 什么是同构渲染

#### 何为同构

同构是指写一份代码可以同时在浏览器和服务器运行的应用。为了同时拥有 SSR 和 CSR 的特点，当前流行的方案就是 SSR+CSR 同构，比如流行的 next.js

#### 认识同构

同构应用运行原理的核心在于虚拟 DOM，虚拟 DOM 的优点在于：

1. 因为操作 DOM 树是高耗时的操作，尽量减少 DOM 树操作能优化页面性能。而 DOM Diff 算法能找出 2 个不同的 DOM 之间最小差异，简化对 DOM 的操作。

2. 虚拟 DOM 在渲染的时候不仅可以通过操作 DOM 树来表示结果，也能有其他表示方法。例如虚拟 DOM 渲染成字符串（服务端渲染）等。

构建同构应用的最终目的是从一份项目源码中构建出 2 份 JavaScript 代码。一份用于在 node 环境中运行渲染出 html。其中用于在 node 环境中运行的 JavaScript 代码需要注意：

1. 不能包含浏览器环境提供的 API
2. 不建议包含 css 代码，因为渲染 css 代码会额外增加计算量，影响服务端渲染，因此建议 css 需要使用外联方式。
3. 不能想用于浏览器环境输出代码那样把 node_modules 里的第三方模块和 nodejs 原生模块打包进去，而是需要分开打包，客户端和服务端分别打包一份，或者打包的时候区分各自运行文件。
